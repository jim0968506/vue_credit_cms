{"ast":null,"code":"import \"core-js/modules/web.url-search-params.delete.js\";\nimport \"core-js/modules/web.url-search-params.has.js\";\nimport \"core-js/modules/web.url-search-params.size.js\";\nimport { contractList, generateContract, downloadContract } from '@/apis/loan.js';\nimport request from '@/utils/request';\nexport default {\n  data() {\n    return {\n      pageOptions: {\n        pageNo: 1,\n        pageSize: 10\n      },\n      rows: 0,\n      query: '',\n      tableData: [],\n      columns: [{\n        label: \"姓名\",\n        prop: \"name\",\n        width: \"100\"\n      }, {\n        label: \"身份證\",\n        prop: \"identity_card\",\n        width: \"260\"\n      }, {\n        label: \"合同狀態\",\n        prop: \"status\",\n        width: \"160\"\n      }, {\n        label: \"操作\",\n        prop: \"opts\"\n      }]\n    };\n  },\n  methods: {\n    async createContract(id) {\n      let res = await generateContract(id);\n      if (res.data.code === 20000) {\n        this.getContractList();\n      }\n    },\n    async downContract(id) {\n      let res = await downloadContract(id);\n      if (res.data.code === 20000) {\n        //對請求回來的地址去除/api\n        let url = res.data.data.url.replace('/api', '');\n        let fileName = '貸款合同-' + id + '.docx';\n        //使用拆分的url再次請求，並指定請求返回的資料類型為'blob\n        let res2 = await request({\n          url,\n          responseType: 'blob'\n        });\n        // 記憶體中的臨時指向\n        let link = window.URL.createObjectURL(res2.data);\n        // 建立a標籤\n        let tagA = document.createElement('a');\n        // tag\n        tagA.href = link;\n        tagA.download = fileName;\n        // 隱藏a標籤\n        tagA.style.display = 'none';\n        // 插入到body中\n        document.body.appendChild(tagA);\n        // 點選a標籤\n        tagA.click();\n        // 釋放資源 \n        document.body.removeChild(tagA);\n        // 釋放臨時url\n        window.URL.revokeObjectURL(url);\n      }\n    },\n    async setQueryName() {\n      this.pageOptions.name = this.query;\n      await this.getContractList();\n      this.pageOptions.name = null;\n    },\n    async getContractList() {\n      let res = await contractList(this.pageOptions);\n      if (res.data.code === 20000) {\n        this.tableData = res.data.data.data.data;\n        this.rows = res.data.data.rows;\n      }\n    },\n    handleCurrentChange(pageNo) {\n      this.pageOptions.pageNo = pageNo;\n      this.getContractList();\n    },\n    updateSize(pageSize) {\n      this.pageOptions.pageSize = pageSize;\n      this.getContractList();\n    }\n  },\n  mounted() {\n    this.getContractList();\n  }\n};","map":{"version":3,"names":["contractList","generateContract","downloadContract","request","data","pageOptions","pageNo","pageSize","rows","query","tableData","columns","label","prop","width","methods","createContract","id","res","code","getContractList","downContract","url","replace","fileName","res2","responseType","link","window","URL","createObjectURL","tagA","document","createElement","href","download","style","display","body","appendChild","click","removeChild","revokeObjectURL","setQueryName","name","handleCurrentChange","updateSize","mounted"],"sources":["src/views/contract-manage/IndexView.vue"],"sourcesContent":["<template>\r\n    <div id=\"input-manager\">\r\n        <el-row>\r\n            <el-col :span=\"22\">\r\n                <el-input placeholder=\"請輸入名稱\" type=\"text\" v-model=\"query\"></el-input>\r\n            </el-col>\r\n            <el-col :span=\"2\">\r\n                <!-- 按鈕 -->\r\n                <el-button type=\"primary\" @click=\"setQueryName\">搜尋</el-button>\r\n            </el-col>\r\n        </el-row>\r\n        <el-table :data=\"tableData\" id=\"gbox\" :useIndex=\"true\" :stripe=\"true\" :border=\"true\" :fit=\"true\"\r\n            :useMultiSelect=\"false\">\r\n            <el-table-column type=\"index\" label=\"序號\" width=\"55\" align=\"center\">\r\n            </el-table-column>\r\n            <el-table-column v-for=\"(col, index) in columns\" :key=\"index\" :label=\"col.label\" :prop=\"col.prop\"\r\n                :width=\"col.width\">\r\n                <!--插槽，如果當前列是操作，新增三個按鈕-->\r\n                <template v-slot=\"{ column, row }\">\r\n                    <div v-if=\"column.property === 'opts'\">\r\n                        <!--5代表終審通過,大於5就代表已經生成合同了，需要禁用-->\r\n                        <el-button :disabled=\"row['status'] > 5\" @click=\"createContract(row.id)\"\r\n                            type=\"primary\">生成合同</el-button>\r\n                        <!--7代表生成合同,不等於7需要禁用-->\r\n                        <el-button :disabled=\"row['status'] !== 7\" @click=\"downContract(row.id)\"\r\n                            type=\"success\">下載合同</el-button>\r\n                    </div>\r\n                    <div v-else-if=\"column.property === 'status'\">\r\n                        <el-tag :type=\"row[column.property] === 7 ? 'success' : ''\">{{ row[column.property] === 7 ? '生成合同' :\r\n                            '未生成合同'\r\n                        }}</el-tag>\r\n\r\n                    </div>\r\n                    <div v-else>\r\n                        {{ row[column.property] }}\r\n                    </div>\r\n                </template>\r\n\r\n            </el-table-column>\r\n\r\n\r\n        </el-table>\r\n        <el-pagination @current-change=\"handleCurrentChange\" @size-change=\"updateSize\" :page-sizes=\"[10, 20, 30, 40]\"\r\n            :page-size=\"pageOptions.pageSize\" layout=\"total, sizes, prev, pager, next, jumper\" :total=\"rows\">\r\n        </el-pagination>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport { contractList, generateContract, downloadContract } from '@/apis/loan.js'\r\nimport request from '@/utils/request'\r\n\r\nexport default {\r\n    data() {\r\n        return {\r\n            pageOptions: {\r\n                pageNo: 1,\r\n                pageSize: 10\r\n            },\r\n            rows: 0,\r\n            query: '',\r\n            tableData: [],\r\n            columns: [\r\n                {\r\n                    label: \"姓名\",\r\n                    prop: \"name\",\r\n                    width: \"100\",\r\n                },\r\n                {\r\n                    label: \"身份證\",\r\n                    prop: \"identity_card\",\r\n                    width: \"260\",\r\n                },\r\n                {\r\n                    label: \"合同狀態\",\r\n                    prop: \"status\",\r\n                    width: \"160\",\r\n                },\r\n                {\r\n                    label: \"操作\",\r\n                    prop: \"opts\",\r\n                },\r\n            ],\r\n        }\r\n    },\r\n    methods: {\r\n        async createContract(id) {\r\n            let res = await generateContract(id)\r\n            if (res.data.code === 20000) {\r\n                this.getContractList()\r\n            }\r\n        },\r\n        async downContract(id) {\r\n            let res = await downloadContract(id)\r\n            if (res.data.code === 20000) {\r\n                //對請求回來的地址去除/api\r\n                let url = res.data.data.url.replace('/api', '')\r\n                let fileName = '貸款合同-' + id + '.docx'\r\n                //使用拆分的url再次請求，並指定請求返回的資料類型為'blob\r\n                let res2 = await request({\r\n                    url,\r\n                    responseType: 'blob'\r\n                })\r\n                // 記憶體中的臨時指向\r\n                let link = window.URL.createObjectURL(res2.data)\r\n                // 建立a標籤\r\n                let tagA = document.createElement('a')\r\n                // tag\r\n                tagA.href = link\r\n                tagA.download = fileName\r\n                // 隱藏a標籤\r\n                tagA.style.display = 'none'\r\n                // 插入到body中\r\n                document.body.appendChild(tagA)\r\n                // 點選a標籤\r\n                tagA.click()\r\n                // 釋放資源 \r\n                document.body.removeChild(tagA)\r\n                // 釋放臨時url\r\n                window.URL.revokeObjectURL(url)\r\n            }\r\n        },\r\n        async setQueryName() {\r\n            this.pageOptions.name = this.query\r\n            await this.getContractList()\r\n            this.pageOptions.name = null\r\n        },\r\n\r\n        async getContractList() {\r\n            let res = await contractList(this.pageOptions);\r\n            if (res.data.code === 20000) {\r\n                this.tableData = res.data.data.data.data\r\n                this.rows = res.data.data.rows;\r\n            }\r\n        },\r\n        handleCurrentChange(pageNo) {\r\n            this.pageOptions.pageNo = pageNo\r\n            this.getContractList()\r\n        },\r\n        updateSize(pageSize) {\r\n            this.pageOptions.pageSize = pageSize\r\n            this.getContractList()\r\n        }\r\n    },\r\n    mounted() {\r\n        this.getContractList();\r\n    },\r\n}\r\n</script>\r\n<style lang=\"scss\" scoped>\r\n::v-deep .el-table--scrollable-x .el-table__body-wrapper {\r\n    overflow-x: hidden;\r\n}\r\n\r\n.el-select,\r\n.el-input {\r\n    width: 100%;\r\n}\r\n\r\n.btns {\r\n    text-align: center;\r\n}\r\n\r\n.box-card {\r\n    margin-bottom: 10px;\r\n\r\n    >div {\r\n        >div {\r\n            text-align: left;\r\n        }\r\n    }\r\n}\r\n\r\n.el-row {\r\n    margin-bottom: 10px;\r\n}\r\n</style>"],"mappings":";;;AAiDA,SAAAA,YAAA,EAAAC,gBAAA,EAAAC,gBAAA;AACA,OAAAC,OAAA;AAEA;EACAC,KAAA;IACA;MACAC,WAAA;QACAC,MAAA;QACAC,QAAA;MACA;MACAC,IAAA;MACAC,KAAA;MACAC,SAAA;MACAC,OAAA,GACA;QACAC,KAAA;QACAC,IAAA;QACAC,KAAA;MACA,GACA;QACAF,KAAA;QACAC,IAAA;QACAC,KAAA;MACA,GACA;QACAF,KAAA;QACAC,IAAA;QACAC,KAAA;MACA,GACA;QACAF,KAAA;QACAC,IAAA;MACA;IAEA;EACA;EACAE,OAAA;IACA,MAAAC,eAAAC,EAAA;MACA,IAAAC,GAAA,SAAAjB,gBAAA,CAAAgB,EAAA;MACA,IAAAC,GAAA,CAAAd,IAAA,CAAAe,IAAA;QACA,KAAAC,eAAA;MACA;IACA;IACA,MAAAC,aAAAJ,EAAA;MACA,IAAAC,GAAA,SAAAhB,gBAAA,CAAAe,EAAA;MACA,IAAAC,GAAA,CAAAd,IAAA,CAAAe,IAAA;QACA;QACA,IAAAG,GAAA,GAAAJ,GAAA,CAAAd,IAAA,CAAAA,IAAA,CAAAkB,GAAA,CAAAC,OAAA;QACA,IAAAC,QAAA,aAAAP,EAAA;QACA;QACA,IAAAQ,IAAA,SAAAtB,OAAA;UACAmB,GAAA;UACAI,YAAA;QACA;QACA;QACA,IAAAC,IAAA,GAAAC,MAAA,CAAAC,GAAA,CAAAC,eAAA,CAAAL,IAAA,CAAArB,IAAA;QACA;QACA,IAAA2B,IAAA,GAAAC,QAAA,CAAAC,aAAA;QACA;QACAF,IAAA,CAAAG,IAAA,GAAAP,IAAA;QACAI,IAAA,CAAAI,QAAA,GAAAX,QAAA;QACA;QACAO,IAAA,CAAAK,KAAA,CAAAC,OAAA;QACA;QACAL,QAAA,CAAAM,IAAA,CAAAC,WAAA,CAAAR,IAAA;QACA;QACAA,IAAA,CAAAS,KAAA;QACA;QACAR,QAAA,CAAAM,IAAA,CAAAG,WAAA,CAAAV,IAAA;QACA;QACAH,MAAA,CAAAC,GAAA,CAAAa,eAAA,CAAApB,GAAA;MACA;IACA;IACA,MAAAqB,aAAA;MACA,KAAAtC,WAAA,CAAAuC,IAAA,QAAAnC,KAAA;MACA,WAAAW,eAAA;MACA,KAAAf,WAAA,CAAAuC,IAAA;IACA;IAEA,MAAAxB,gBAAA;MACA,IAAAF,GAAA,SAAAlB,YAAA,MAAAK,WAAA;MACA,IAAAa,GAAA,CAAAd,IAAA,CAAAe,IAAA;QACA,KAAAT,SAAA,GAAAQ,GAAA,CAAAd,IAAA,CAAAA,IAAA,CAAAA,IAAA,CAAAA,IAAA;QACA,KAAAI,IAAA,GAAAU,GAAA,CAAAd,IAAA,CAAAA,IAAA,CAAAI,IAAA;MACA;IACA;IACAqC,oBAAAvC,MAAA;MACA,KAAAD,WAAA,CAAAC,MAAA,GAAAA,MAAA;MACA,KAAAc,eAAA;IACA;IACA0B,WAAAvC,QAAA;MACA,KAAAF,WAAA,CAAAE,QAAA,GAAAA,QAAA;MACA,KAAAa,eAAA;IACA;EACA;EACA2B,QAAA;IACA,KAAA3B,eAAA;EACA;AACA"},"metadata":{},"sourceType":"module","externalDependencies":[]}